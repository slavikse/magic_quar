(function(t){function e(e){for(var i,o,s=e[0],c=e[1],l=e[2],d=0,h=[];d<s.length;d++)o=s[d],a[o]&&h.push(a[o][0]),a[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(h.length)h.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(i=!1)}i&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},a={app:0},r=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var i=n("27fb"),a=n.n(i);a.a},1:function(t,e){},"27fb":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"clients",function(){return f}),n.d(i,"player",function(){return y});n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),r=!0;a["a"].config.productionTip=!1,a["a"].config.silent=r;n("b048"),n("32c0"),n("4503");var o=n("2f62"),s={add:function(t,e){var n=t.commit;n("ADD",e)},update:function(t,e){var n=t.commit;n("UPDATE",e)},delete:function(t,e){var n=t.commit;n("DELETE",e)}},c=n("cebc"),l=n("768b"),u=n("2d1f"),d=n.n(u),h=(n("ac6a"),n("f3e2"),{ADD:function(t,e){t.clients=e},UPDATE:function(t,e){d()(e).forEach(function(e){var n=Object(l["a"])(e,2),i=n[0],r=n[1];a["a"].set(t.clients,i,Object(c["a"])({},t.clients[i],{clientId:i},r))})},DELETE:function(t,e){a["a"].delete(t.clients,e)}}),p={clients:{}},f={namespaced:!0,actions:s,mutations:h,state:p},m={latency:function(t,e){var n=t.commit;n("LATENCY",e)}},b={LATENCY:function(t,e){t.latency=e}},g={latency:-1},y={namespaced:!0,actions:m,mutations:b,state:g};a["a"].use(o["a"]);var v=!1,w=new o["a"].Store({modules:i,strict:v});a["a"].store=w;var x,E,A=w,j=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-scene",{attrs:{id:"App",physics:"","vr-mode-ui":"enabled: false"}},[n("AssetsImages"),n("Balls"),n("Clients"),n("Lights"),n("Player"),n("Walls"),-1!==t.latency?n("div",{staticClass:"latency"},[t._v("\n    "+t._s(t.latency)+"ms\n  ")]):t._e()],1)},R=[],M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-assets",{attrs:{id:"AssetsImages"}},[n("img",{attrs:{id:"AssetsImagesRoof",src:"images/roof.jpg"}}),n("img",{attrs:{id:"AssetsImagesFloor",src:"images/floor.jpg"}}),n("img",{attrs:{id:"AssetsImagesWall",src:"images/wall.jpg"}})])},_=[],O={name:"AssetsImages"},I=O,P=n("2877"),T=Object(P["a"])(I,M,_,!1,null,null,null),W=T.exports,B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-entity",{attrs:{id:"Balls"}},[t._l(t.balls,function(e){var i=e.id,a=e.isShown;return[a?n("BallsBall",{key:i,attrs:{id:i}}):t._e()]})],2)},k=[],C=(n("d25f"),n("75fc")),L=(n("96cf"),n("3b8d")),$=(n("759f"),n("c437")),D=n.n($),Q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-box",{attrs:{id:"BallsBall",src:"#AssetsImagesRoof","dynamic-body":"mass: 10",color:"#999"},on:{collide:t.collide}})},S=[],F={name:"BallsBall",methods:{collide:function(t){switch(t.detail.contact.bj.el.id){case"MobsMagicQuARShape":document.dispatchEvent(new CustomEvent("MobsMagicQuARCollide"));break;default:}}}},H=F,U=Object(P["a"])(H,Q,S,!1,null,null,null),z=U.exports,J={name:"Balls",components:{BallsBall:z},data:function(){return{balls:[],lifeTime:1e4,intervalId:void 0,clearTime:2e4}},mounted:function(){document.addEventListener("PlayerFire",this.fire),this.intervalId=setInterval(this.cleaner,this.clearTime)},destroyed:function(){document.removeEventListener("PlayerFire",this.fire),clearInterval(this.intervalId)},methods:{fire:function(t){var e=this,n=t.detail,i=n.position,a=n.direction,r=D()();setTimeout(function(){return e.hide(r)},this.lifeTime),this.balls.push({id:r,isShown:!0}),this.$nextTick(function(){return e.acceleration(r,i,a)})},hide:function(t){var e=this;this.balls.some(function(n,i){var a=n.id;return a===t&&(e.balls[i].isShown=!1,!0)})},acceleration:function(){var t=Object(L["a"])(regeneratorRuntime.mark(function t(e,n,i){var a,r,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,document.getElementById(e);case 2:o=t.sent,(a=o.body.position).set.apply(a,Object(C["a"])(n)),(r=o.body.velocity).set.apply(r,Object(C["a"])(i));case 5:case"end":return t.stop()}},t)}));function e(e,n,i){return t.apply(this,arguments)}return e}(),cleaner:function(){this.balls=this.balls.filter(function(t){var e=t.isShown;return e})}}},V=J,N=Object(P["a"])(V,B,k,!1,null,null,null),Y=N.exports,q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-entity",{attrs:{id:"Clients"}},t._l(t.clients,function(t){return n("a-entity",{key:t.clientId,attrs:{id:"Clients_"+t.clientId,position:t.position.join(", "),rotation:t.rotation.join(", "),"kinematic-body":""}},[n("a-entity",{attrs:{id:"MobsMagicQuARShape"}},[n("a-box",{attrs:{id:"MobsMagicQuARHead",constraint:"target: #MobsMagicQuARBody",position:"0 1.5 0",width:"0.4",height:"0.4",depth:"0.4",color:"#755"}}),n("a-box",{attrs:{id:"MobsMagicQuARBody",position:"0 0.4 0",width:"0.7",height:"1.5",depth:"0.7",color:"#955"}}),n("a-box",{attrs:{id:"MobsMagicQuARLeftHand",constraint:"target: #MobsMagicQuARBody",position:"-0.7 0.6 0",width:"0.3",height:"1",depth:"0.3",color:"#755"}}),n("a-box",{attrs:{id:"MobsMagicQuARRightHand",constraint:"target: #MobsMagicQuARBody",position:"0.7 0.6 0",width:"0.3",height:"1",depth:"0.3",color:"#755"}}),n("a-box",{attrs:{id:"MobsMagicQuARLeftLeg",constraint:"target: #MobsMagicQuARBody",position:"-0.4 -0.84 0",width:"0.5",height:"0.3",depth:"0.5",color:"#755"}}),n("a-box",{attrs:{id:"MobsMagicQuARRightLeg",constraint:"target: #MobsMagicQuARBody",position:"0.4 -0.84 0",width:"0.5",height:"0.3",depth:"0.5",color:"#755"}})],1)],1)}),1)},G=[],K={name:"Clients",computed:Object(c["a"])({},Object(o["b"])("clients",["clients"])),watch:{clients:{deep:!0,handler:function(){var t=this;d()(this.clients).forEach(function(e){var n=Object(l["a"])(e,2),i=n[0],a=n[1].fire;if(a){var r=new CustomEvent("PlayerFire",{detail:a});document.dispatchEvent(r),delete t.clients[i].fire}})}}}},X=K,Z=Object(P["a"])(X,q,G,!1,null,null,null),tt=Z.exports,et=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-entity",{attrs:{id:"Lights"}},[n("a-light",{attrs:{id:"LightsAmbient",type:"ambient",color:"white"}})],1)},nt=[],it={name:"Lights"},at=it,rt=Object(P["a"])(at,et,nt,!1,null,null,null),ot=rt.exports,st=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-entity",{attrs:{id:"Player","movement-controls":"speed: 0.4","kinematic-body":"enableJumps: true","jump-ability":"distance: 2.5; maxJumps: 2"}},[n("a-entity",{ref:"Player",attrs:{id:"PlayerCamera",position:"0 1.6 0","look-controls":"pointerLockEnabled: true",camera:""},on:{click:t.click}},[n("a-cursor",{ref:"Cursor",attrs:{id:"PlayerCursor",scale:"0.5 0.5 0.5"}})],1)],1)},ct=[],lt=(n("6d67"),n("8055")),ut=n.n(lt),dt="http://134.0.117.200:3000",ht={transports:["websocket"]},pt=1e3/60,ft={name:"Player",data:function(){return{clientId:-1,Player:void 0,Cursor:void 0,click:function(){},rate:200,acceleration:-20,position:[0,0,0],rotation:[0,0,0]}},mounted:function(){this.initial(),this.connect(),this.broadcast()},destroyed:function(){clearTimeout(E)},methods:{initial:function(){this.Player=this.$refs.Player.object3D,this.Cursor=this.$refs.Cursor.object3D,this.click=window.AFRAME.utils.throttle(this.fire,this.rate)},fire:function(){var t=this,e=this.Cursor.getWorldPosition(new window.THREE.Vector3),n=e.x,i=e.y,a=e.z,r=this.Cursor.getWorldDirection(new window.THREE.Vector3),o=r.x,s=r.y,c=r.z,l={position:[n,i,a],direction:[o,s,c].map(function(e){return e*t.acceleration})},u=new CustomEvent("PlayerFire",{detail:l});document.dispatchEvent(u),x.emit("clientUpdate",{fire:l})},connect:function(){var t=this;x=ut()("".concat(dt,"/clients"),ht),x.once("connected",function(){var e=Object(L["a"])(regeneratorRuntime.mark(function e(n){var i,a,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:i=n.clientId,a=n.clients,t.clientId=i,t.$store.dispatch("clients/add",a),r={position:t.position,rotation:t.rotation},x.emit("connected",r),console.log("client id",i);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),x.on("clientUpdate",function(){var e=Object(L["a"])(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("clients/update",n);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),x.on("pong",function(){var e=Object(L["a"])(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("player/latency",n);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),x.on("disconnected",function(){var e=Object(L["a"])(regeneratorRuntime.mark(function e(n){var i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i=n.clientId,console.log("disconnected",i),e.next=4,t.$store.dispatch("clients/delete",i);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())},broadcast:function(){E=setTimeout(this.broadcast,pt);var t=this.Player.getWorldPosition(new window.THREE.Vector3),e=t.x,n=t.y,i=t.z;this.position=[e,n,i];var a=this.Player.rotation,r=a._x,o=a._y,s=a._z;this.rotation=[window.THREE.Math.radToDeg(r),window.THREE.Math.radToDeg(o),window.THREE.Math.radToDeg(s)],x.emit("clientUpdate",{position:this.position,rotation:this.rotation})}}},mt=ft,bt=Object(P["a"])(mt,st,ct,!1,null,null,null),gt=bt.exports,yt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-entity",{attrs:{id:"Walls"}},[n("a-box",{attrs:{id:"WallsRoof",src:"#AssetsImagesRoof",position:"0 10 0",rotation:"-90 0 0",height:"30",width:"30",depth:"0.5",repeat:"5 10","static-body":""}}),n("a-plane",{attrs:{id:"WallsFloor",src:"#AssetsImagesFloor",rotation:"-90 0 0",height:"80",width:"80",repeat:"30 45","static-body":""}}),n("a-box",{attrs:{id:"WallsFront",src:"#AssetsImagesWall",position:"0 5 -15",rotation:"0 0 0",height:"10",width:"30",depth:"0.5",repeat:"10 6","static-body":""}}),n("a-box",{attrs:{id:"WallsLeft",src:"#AssetsImagesWall",position:"0 5 15",rotation:"0 180 0",height:"10",width:"30",depth:"0.5",repeat:"10 6","static-body":""}}),n("a-box",{attrs:{id:"WallsRight",src:"#AssetsImagesWall",position:"-15 5 0",rotation:"0 90 0",height:"10",width:"30",depth:"0.5",repeat:"10 6","static-body":""}}),n("a-box",{attrs:{id:"WallsBack",src:"#AssetsImagesWall",position:"15 5 0",rotation:"0 -90 0",height:"10",width:"30",depth:"0.5",repeat:"10 6","static-body":""}}),n("a-box",{attrs:{id:"WallsBox_1",src:"#AssetsImagesWall",position:"0 3 4",rotation:"30 0 0",height:"15",width:"15",repeat:"2 10","static-body":""}}),n("a-box",{attrs:{id:"WallsBox_2",src:"#AssetsImagesWall",position:"5 1 -10",rotation:"0 0 0",height:"3",width:"10",depth:"2",repeat:"5 8","static-body":""}}),n("a-box",{attrs:{id:"WallsBox_3",src:"#AssetsImagesWall",position:"-5 1.5 -3",rotation:"39 -143 -145",height:"3",width:"10",depth:"2",repeat:"5 8","static-body":""}})],1)},vt=[],wt={name:"Walls"},xt=wt,Et=Object(P["a"])(xt,yt,vt,!1,null,null,null),At=Et.exports,jt={name:"App",components:{AssetsImages:W,Balls:Y,Clients:tt,Lights:ot,Player:gt,Walls:At},computed:Object(c["a"])({},Object(o["b"])("player",["latency"]))},Rt=jt,Mt=(n("034f"),Object(P["a"])(Rt,j,R,!1,null,null,null)),_t=Mt.exports;new a["a"]({store:A,render:function(t){return t(_t)}}).$mount("#app")}});
//# sourceMappingURL=app.661e312b.js.map